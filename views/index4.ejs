<!DOCTYPE html>
<html>
<head>
  <title>Hot Toddy</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    .table-responsive {
      overflow-x: auto;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      white-space: nowrap;
    }
    th, td {
      border: 1px solid black;
      padding: 8px;
    }
    .image-wrapper {
      border: 2px solid blue;
      padding: 2px;
      display: inline-block;
      overflow: hidden;
    }
    .image-wrapper img {
      transition: transform 0.3s ease;
    }
    .image-wrapper:hover img {
      transform: scale(1.1);
    }
    .clicked {
      background-color: yellow;
    }
    #floatingImage {
      width: 50px;
      height: auto;
      position: fixed;
      right: 0px;
      bottom: 20px;
      z-index: 9999;
    }
    .table-striped tbody tr:hover td {
    background-color: rgb(219, 201, 188);
    }
  </style>
</head>
<body>
  <header style="background-color: rgb(219, 201, 188);" class="text-white py-4">
    <div class="container-fluid mx-5">
      <h1>Hot Toddy Notion DATA to Shopify (Products)</h1>
    </div>
  </header>
  
  <!-- 一鍵上架 -->
  <div class="mx-5 mt-3 d-flex justify-content-end">
    <button id="All_Shopify" class="btn btn-primary" onclick="LaunchProducts();">全部上架</button>
    <div style="width: 10px;"></div>
    <button id="uptodata" class="btn btn-warning text-white" onclick="UPtoDate();">全部更新</button>
    <div style="width: 20px;"></div>
  </div>  
  <!-- toast -->
  <button type="button" class="btn btn-primary" id="liveToastBtn" style="display: none;">Show live toast</button>

  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <img src="images/gear.png" class="rounded me-2" alt="...">
        <strong class="me-auto">提示</strong>
        <small>11 mins ago</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        <!-- 使用占位符表示动态修改的部分 -->
        所有商品已上架成功.
      </div>
    </div>
  </div>
  
  <div class="container-fluid mt-4">
    <div class="mx-5 table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>⭐️SKU🤖</th>
            <th>確認</th>
            <th>分類🤖✅</th>
            <th>tag🤖✅</th>
            <th>品名🤖✅</th>
            <th>定價🤖✅</th>
            <th>庫1🤖✅</th>
            <th>庫2✅</th>
            <th>memo</th>
            <th>圖片🤖</th>
            <th>更新</th>
            <th>⭐️spid</th>
          </tr>
        </thead>
        <tbody class="table-striped align-middle">
          <% items.forEach(function(item) { %>
            <tr>
              <td><%= item.SKU %></td>
              <td><%= item.確認 %></td>
              <td style="white-space: normal;"><%= item.分類 %></td>
              <td><%= item.tag.join(', ') %></td>
              <td style="white-space: normal;"><%= item.品名 %></td>
              <td style="text-align: right;"><%= item.定價 %></td>
              <td style="text-align: right;"><%= item.庫1 %></td>
              <td style="text-align: right;"><%= item.庫2 %></td>
              <td><%= item.memo %></td>
              <!-- <td><%= item.圖片 %></td> -->
              <td class="text-center">
                <% if (item.spid) { %>
                  <a href="https://hottoddy444.myshopify.com/admin/products/<%= item.spid %>" target="_blank">
                    <% if (item.圖片) { %>
                      <div class="image-wrapper">
                        <img src="<%= item.圖片 %>" style="max-width: 100px; max-height: 100px;" alt="圖片">
                      </div>
                    <% } else { %>
                      没有圖片
                    <% } %>
                  </a>
                <% } else if (item.圖片) { %>
                  <img src="<%= item.圖片 %>" style="max-width: 100px; max-height: 100px;" alt="圖片">
                <% } else { %>
                  没有圖片
                <% } %>
              </td>
              
              <% if (item.確認 && item.更新 && item.spid==="") { %>
                <td class="text-center">  
                  <button id="<%- item.SKU %>_btn" class="btn btn-primary" onclick='handleClick("<%- JSON.stringify(item.SKU).slice(1, -1) %>","<%- JSON.stringify(item.spid).slice(1, -1)%>")'>上架</button>
                </td>
              <% } else if (item.更新 && item.spid) { %>
                <td class="text-center text-danger">需要修改</td>
              <% } else { %>
                <td class="text-center"></td>
              <% } %>
              
              <% if (item.spid) { %>
                <td class="text-center">
                  <button id="sp_<%= item.spid %>" class="btn btn-secondary" onclick='modifyShopityItem("<%= item.SKU %>","<%= item.spid %>")' <%= item.更新 && item.spid ? "" : "disabled" %>>修改 <%= item.spid %></button>
                </td>
              <% } else { %>
                <td class="text-center"></td>
              <% } %>

            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>
  <div class="mx-5 mt-3">
    <h4>🤖:第一次電商上架會變更的欄位~~~✅:修改會變更的欄位~~~⭐️：唯一識別欄位(不可更動)</h4>
  </div>
  <footer style="background-color: rgb(219, 201, 188);" class="text-white py-5">
    <div class="container" style="display: flex; align-items: center; height: 100%;">
      <p style="text-align: center; margin: auto;">&copy; 2023 Hot Toddy. All rights reserved. (amber)</p>
    </div>
  </footer>
  
  <img id="floatingImage" src="images/b2t.png" onclick="moveTop()" />

  <script src="../javascripts/magic.js"></script>
</body>
</html>
