<!DOCTYPE html>
<html>
<head>
  <title>Hot Toddy</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="/stylesheets/index.css">
  <link rel="icon" type="image/x-icon" href="images/fire.ico" />

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      magicFunction(); // è°ƒç”¨å‡½æ•°ä»¥å¯åŠ¨è¿›åº¦æ¡åŠŸèƒ½

      // æ£€æµ‹é¡µé¢æ˜¯å¦åˆ·æ–°
      if (performance.navigation.type === 1) {
        // é¡µé¢åˆ·æ–°ï¼Œå°†æ»šåŠ¨ä½ç½®è®¾ä¸ºæœ€é¡¶éƒ¨
        window.scrollTo(0, 0);
      }
    });
  </script>
</head>
<body>
  <header style="background-color: rgb(219, 201, 188);" class="text-white py-4">
    <div class="container-fluid mx-5">
      <h1>
        <img src="images/crown.png" style="max-height: 50px;margin-right: 20px;">
        Hot Toddy Notion DATA to Shopify (Products)
        <div style="float: right; margin-right: 150px;">
          <img src="images/sandn.png" style="max-height: 60px;">
        </div>
      </h1>
    </div>
  </header>
  
  <script>
    // magicFunction(); // è°ƒç”¨å‡½æ•°ä»¥å¯åŠ¨è¿›åº¦æ¡åŠŸèƒ½
  </script>
  <div class="progress-container" id="progressContainer">
    <div class="progress-bar">
      <div class="color"></div>
    </div>
  </div>
  
  <!-- å…¶ä»–å†…å®¹ -->
  
  <div class="mx-5 mt-3 d-flex justify-content-end">
    <a href="./orders" target="_blank">
      <img src="images/mhb.png" style="max-height: 50px; border: 1px solid #000; border-radius: 5px;">
    </a>
    <div style="width: 15px;"></div>
    <button id="All_Shopify" class="btn btn-primary" onclick="LaunchProducts();">å…¨éƒ¨ä¸Šæ¶</button>
    <div style="width: 10px;"></div>
    <button id="uptodata" class="btn btn-warning text-white" onclick="UPtoDate();">å…¨éƒ¨æ›´æ–°</button>
    <div style="width: 20px;"></div>
</div>

  
  <!-- toast -->
  <button type="button" class="btn btn-primary" id="liveToastBtn" style="display: none;">Show live toast</button>

  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <img src="images/gear.png" class="rounded me-2" alt="...">
        <strong class="me-auto">æç¤º</strong>
        <small class="toast-time">11 mins ago</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        <!-- ä½¿ç”¨å ä½ç¬¦è¡¨ç¤ºåŠ¨æ€ä¿®æ”¹çš„éƒ¨åˆ† -->
        æ‰€æœ‰å•†å“å·²ä¸Šæ¶æˆåŠŸ.
      </div>
    </div>
  </div>
  
  <div class="container-fluid mt-4">
    <div class="mx-5 table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>â­ï¸SKUğŸ¤–</th>
            
            <th>åˆ†é¡ğŸ¤–âœ…</th>
            <th>tagğŸ¤–âœ…</th>
            <th>å“åğŸ¤–âœ…</th>
            <th>å®šåƒ¹ğŸ¤–âœ…</th>
            <th>åº«1ğŸ¤–âœ…</th>
            <th>åº«2âœ…</th>
            <th>memo</th>
            <th style="text-align: center;">QRCode</th>
            <th>åœ–ç‰‡ğŸ¤–</th>
            <th>æ›´æ–°</th>
            <th>â­ï¸spid</th>
          </tr>
        </thead>
        <tbody class="table-striped align-middle">
          <% items.forEach(function(item) { %>
            <tr>
              <td><%= item.SKU %></td>
              
              <td style="white-space: normal;"><%= item.åˆ†é¡ %></td>
              <td><%= item.tag.join(', ') %></td>
              <td style="white-space: normal;"><%= item.å“å %></td>
              <td style="text-align: right;"><%= item.å®šåƒ¹ %></td>
              <td style="text-align: right;"><%= item.åº«1 %></td>
              <td style="text-align: right;"><%= item.åº«2 %></td>
              <td><%= item.memo %></td>
              <td><img src="https://cdn.shopify.com/s/files/1/0637/2291/4006/files/sku_qr_<%=item.SKU %>.png" alt="æœªæä¾›" width="100" height="100" ></td>
              <!-- <td><%= item.åœ–ç‰‡ %></td> -->
              <td class="text-center">
                <% if (item.spid) { %>
                  <a href="https://hottoddy444.myshopify.com/admin/products/<%= item.spid %>" target="_blank">
                    <% if (item.åœ–ç‰‡) { %>
                      <div class="image-wrapper">
                        <img src="<%= item.åœ–ç‰‡ %>" style="max-width: 100px; max-height: 100px;" alt="åœ–ç‰‡">
                      </div>
                    <% } else { %>
                      æ²¡æœ‰åœ–ç‰‡
                    <% } %>
                  </a>
                <% } else if (item.åœ–ç‰‡) { %>
                  <img src="<%= item.åœ–ç‰‡ %>" style="max-width: 100px; max-height: 100px;" alt="åœ–ç‰‡">
                <% } else { %>
                  æ²¡æœ‰åœ–ç‰‡
                <% } %>
              </td>
              
              <% if (item.ç¢ºèª && item.æ›´æ–° && item.spid==="") { %>
                <td class="text-center">  
                  <button id="<%- item.SKU %>_btn" class="btn btn-primary" onclick='handleClick("<%- JSON.stringify(item.SKU).slice(1, -1) %>","<%- JSON.stringify(item.spid).slice(1, -1)%>")'>ä¸Šæ¶</button>
                </td>
              <% } else if (item.æ›´æ–° && item.spid) { %>
                <td class="text-center text-danger">éœ€è¦ä¿®æ”¹</td>
              <% } else { %>
                <td class="text-center"></td>
              <% } %>
              
              <% if (item.spid) { %>
                <td class="text-center">
                  <button id="sp_<%= item.spid %>" class="<%= item.æ›´æ–° && item.spid ? 'btn btn-warning text-white' : 'btn btn-secondary' %>" onclick='modifyShopityItem("<%= item.SKU %>","<%= item.spid %>")' <%= item.æ›´æ–° && item.spid ? '' : 'disabled' %>><%= item.SKU %><br/>ä¿®æ”¹ <%= item.spid %></button>
                </td>
              <% } else { %>
                <td class="text-center"></td>
              <% } %>
              
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>
  <div class="mx-5 mt-3">
    <h4>ğŸ¤–:ç¬¬ä¸€æ¬¡é›»å•†ä¸Šæ¶æœƒè®Šæ›´çš„æ¬„ä½~~~âœ…:ä¿®æ”¹æœƒè®Šæ›´çš„æ¬„ä½~~~â­ï¸ï¼šå”¯ä¸€è­˜åˆ¥æ¬„ä½(ä¸å¯æ›´å‹•)</h4>
  </div>
  <input type="hidden" id="itemsData" data-items='<%- JSON.stringify(items) %>'>


  <footer style="background-color: rgb(219, 201, 188);" class="text-white py-4 mt-2">
    <div class="container" style="display: flex; align-items: center; height: 100%;">
      <p style="text-align: center; margin: auto;">&copy; 2023 Hot Toddy. All rights reserved. (amber)</p>
    </div>
  </footer>
  
  <img id="floatingImage" src="images/b2t.png" onclick="moveTop()" />
 
  <script src="../javascripts/magic.js"></script>
  <script>
    var items = JSON.parse(document.getElementById("itemsData").getAttribute("data-items"));
console.log("items log: ", items);

window.addEventListener("load", function() {
  var progressContainer = document.getElementById("progressContainer");
  var progressBar = document.querySelector(".progress-bar");

  if (items.length > 0) {
    progressContainer.style.display = "flex";
    progressBar.style.animation = "progressBarAnimation 4s forwards"; // æ·»åŠ åŠ¨ç”»å±æ€§
  }

  var itemIndex = 0;
  var progress = 0;
  var updateInterval = 1000; // 1ç§’é’Ÿæ›´æ–°ä¸€æ¬¡è¿›åº¦æ¡

  function updateProgress() {
    progress += 1;
    progressBar.style.width = progress + "%";

    if (progress >= 100) {
      clearInterval(progressInterval);
      progressContainer.style.display = "none";
    }
  }

  var progressInterval = setInterval(updateProgress, updateInterval);

  function processItem(item) {
    // æ¨¡æ‹Ÿå¤„ç†å»¶è¿Ÿ
    setTimeout(function() {
      // å¤„ç†æ¯ä¸ªitemçš„æ“ä½œ

      if (itemIndex === items.length - 1) {
        // æœ€åä¸€ä¸ªitemå¤„ç†å®Œæˆåï¼Œéšè—è¿›åº¦æ¡
        progressContainer.style.display = "none";
      }

      itemIndex++;
    }, Math.random() * 2000); // ä½¿ç”¨éšæœºçš„å»¶è¿Ÿæ—¶é—´æ¥æ¨¡æ‹Ÿä¸åŒçš„å¤„ç†æ—¶é—´
  }

  items.forEach(function(item) {
    processItem(item);
  });
});

  </script>
</body>
</html>
